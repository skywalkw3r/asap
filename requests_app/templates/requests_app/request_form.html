{% extends "requests_app/base.html" %}
{% load static %}

{% block title %}ASAP - New Server Request{% endblock %}

{% block content %}
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h2 class="h5 mb-0">ASAP - Request a New Server</h2>
        </div>
        <div class="card-body">
            <p class="card-text">Please fill out the form below. Fields marked with <span class="text-danger">*</span> are required.</p>

            <form method="post" novalidate>
                {% csrf_token %}

                {# Explicitly render non-field errors if any #}
                {% if form.non_field_errors %}
                    <div class="alert alert-danger">
                        {% for error in form.non_field_errors %}
                            {{ error }}<br>
                        {% endfor %}
                    </div>
                {% endif %}

                {# Loop through fields and apply Bootstrap classes #}
                {% for field in form %}
                    <div class="mb-3 row"> {# Use row for better label alignment on larger screens #}
                        <label for="{{ field.id_for_label }}" class="col-sm-3 col-form-label text-sm-end">
                            {{ field.label }}{% if field.field.required %} <span class="text-danger">*</span>{% endif %}
                        </label>
                        <div class="col-sm-9">
                            {# --- Input Type Handling --- #}
                            {% if field.field.widget.input_type == 'checkbox' %}
                                <div class="form-check pt-2"> {# Add padding-top to align better #}
                                    <input type="{{ field.field.widget.input_type }}"
                                           name="{{ field.name }}"
                                           id="{{ field.id_for_label }}"
                                           class="form-check-input {% if field.errors %}is-invalid{% endif %}"
                                           {% if field.value %}checked{% endif %}>
                                    {# Checkbox label is handled by the main label tag for better accessibility #}
                                </div>
                            {% elif field.field.widget.input_type == 'select' %}
                                <select name="{{ field.name }}"
                                        id="{{ field.id_for_label }}"
                                        class="form-select {% if field.errors %}is-invalid{% endif %}">
                                    {% for value, text in field.field.widget.choices %}
                                        <option value="{{ value }}" {% if field.value|stringformat:"s" == value|stringformat:"s" %}selected{% endif %}>{{ text }}</option>
                                    {% endfor %}
                                </select>
                            {% elif field.field.widget.input_type == 'textarea' %}
                                 <textarea name="{{ field.name }}"
                                           id="{{ field.id_for_label }}"
                                           class="form-control {% if field.errors %}is-invalid{% endif %}"
                                           rows="{{ field.field.widget.attrs.rows|default:'3' }}"
                                           >{% if field.value %}{{ field.value }}{% endif %}</textarea>
                            {% else %} {# Default for text, email, url, number, etc. #}
                                <input type="{{ field.field.widget.input_type }}"
                                       name="{{ field.name }}"
                                       id="{{ field.id_for_label }}"
                                       class="form-control {% if field.errors %}is-invalid{% endif %}"
                                       value="{{ field.value|default:'' }}"
                                       {% if field.field.max_length %}maxlength="{{ field.field.max_length }}"{% endif %}
                                       {% if field.field.required %}required{% endif %}
                                       >
                            {% endif %}
                            {# --- End Input Type Handling --- #}

                            {% if field.errors %}
                                <div class="invalid-feedback">
                                    {{ field.errors|striptags }}
                                </div>
                            {% endif %}
                            {% if field.help_text %}
                                <div class="form-text text-muted">
                                    {{ field.help_text|safe }}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}

                <div class="row mt-4">
                     <div class="col-sm-9 offset-sm-3">
                         <button type="submit" class="btn btn-primary">Submit Request</button>
                         <button type="reset" class="btn btn-outline-secondary ms-2">Reset Form</button>
                     </div>
                 </div>

            </form>
        </div>
    </div>
{% endblock %}